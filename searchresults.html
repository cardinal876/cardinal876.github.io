<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>edwinbook search</title>

<link rel="stylesheet" href="header.css"> <!-- NEW: CSS loads before JS -->
 <script src="data.js"></script>

  

<style>
:root {
  --bg-color: #ffffff;
  --text-color: #111111;
  --accent-color: #10a37f;
  --border-color: #e2e2e2;
  --input-bg: #f9f9f9;
}

* { box-sizing: border-box; }

body {
    visibility:hidden;
  margin: 0;
  padding: 0;
  font-family: system-ui, sans-serif;
  background-color: var(--bg-color);
  color: var(--text-color);
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}



    


/* RESULTS */
.results {
  width: 100%;
  max-width: 700px;
  padding: 1rem 1.5rem;
  margin: 0 auto;
  box-sizing: border-box;
  flex: 1;
    flex-grow: 1; /* Makes the results section grow and fill available space */
}

.result-link {
  display: block;
  text-decoration: none;
  color: inherit;
  border-bottom: 1px solid var(--border-color);
  padding: 1rem 0;
  transition: background-color 0.2s ease;
}

.result-title {
  font-size: 1.25rem;
  font-weight: 400; 
  color: #1a0dab;    
  margin: 0;
  text-decoration: none;
  width: fit-content; 
}

.result-title:hover { text-decoration: underline; }
.result-link:hover { background-color: #f5f5f5; }

.author { font-size: 0.9rem; color: #666; margin-top: 0.25rem;}
.snippet { margin-top: 0.5rem; font-size: 1rem; color: #333; }

footer {
  text-align: center;
  padding: 1rem;
  font-size: 0.9rem;
  color: #888;
  border-top: 1px solid var(--border-color);
  width: 100%;
  margin-top:auto;
  bottom: -100px;  /* Position the footer below the viewport initially */

}



.pagination button {
  margin: 0 4px;
  padding: 5px 10px;
  border: 1px solid var(--border-color);
  background-color: var(--input-bg);
  cursor: pointer;
  border-radius: 4px;
  transition: background-color 0.2s ease;
}
.pagination button:hover:not(:disabled) {
  background-color: #e8e8e8;
}
.pagination button:disabled {
  opacity: 0.5;
  cursor: default;
}





.pagination{
    
    margin-bottom: 1rem;
    
}




</style>

<script src="https://cdn.jsdelivr.net/npm/flexsearch@0.7.31/dist/flexsearch.bundle.js"></script>
</head>
<body>

 <header id="header-container"></header>

<!--

<div class="results">
  <a href="result1005.html" class="result-link">
    <h2 class="result-title">Relativity</h2>
    <div class="author"></div>
    <div class="snippet">
        Relativity is one of the most important and far-reaching ideas in modern science. It changed the way people understand space, time, gravity, and even the nature of the universe itself.
    </div>
  </a>
</div>

-->


<div id="results"></div> <!-- search results will appear here -->








  <footer>
    &copy; 2025 Rays Center for Research, Education, and Econonmic Development™. <a href="terms.html" style="text-decoration:none;color:inherit;" >Terms & Conditions</a>

  </footer>


  
  <script>
    // Sample documents for FlexSearch
 /**   const documents = [
      { id: 1, title: "Apple", content: "A red or green fruit" },
      { id: 2, title: "Banana", content: "A long yellow fruit" },
      { id: 3, title: "Cherry", content: "Small red fruit" },
      { id: 4, title: "Date", content: "Sweet brown fruit" }
    ];
    **/


    
    // Create FlexSearch index
const index = new FlexSearch.Document({
  document: {
    id: "id",
    index: ["combined"], // only search this field
    store: ["id", "title", "content", "url"] // keep others for displaying
  }
});

// Add documents from external JS
if (typeof documents !== 'undefined' && Array.isArray(documents)) {
  documents.forEach(doc => {
    index.add({
      id: doc.id,
      combined: `${doc.title} ${doc.content} ${doc.url || ''}`, // merged searchable text
      title: doc.title,
      content: doc.content,
      url: doc.url
    });
  });
} else {
  console.error("No documents found in data.js");
}

    


    // Add docs to index
  //  documents.forEach(doc => index.add(doc));

    // Load header.html dynamically
    document.addEventListener('DOMContentLoaded', () => {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', 'header.html', true);
      xhr.onreadystatechange = function() {
        if (xhr.readyState === 4 && (xhr.status === 200 || xhr.status == 0)) {
          document.getElementById('header-container').innerHTML = xhr.responseText;

          // Menu toggle logic (optional)
          const menuButton = document.getElementById("menuToggle");
          const menuDropdown = document.getElementById("menuDropdown");
          if (menuButton && menuDropdown) {
            menuButton.addEventListener("click", () => {
              menuDropdown.style.display =
                menuDropdown.style.display === "flex" ? "none" : "flex";
            });
            document.addEventListener("click", (e) => {
              if (!menuButton.contains(e.target) && !menuDropdown.contains(e.target)) {
                menuDropdown.style.display = "none";
              }
            });
          }

          // Attach search logic
          const searchForm = document.getElementById('searchForm');
          const searchInput = document.getElementById('searchInput');
          const resultsContainer = document.getElementById('results');

          if (searchForm && searchInput && resultsContainer) {
            searchForm.addEventListener('submit', (e) => {
              e.preventDefault();
              const query = searchInput.value.trim();
              
              
              
              
              

let flatResults;

if (!query) {
  // No search term — show all documents
  flatResults = documents.map(doc => ({
    id: doc.id,
    title: doc.title,
    content: doc.content,
    url: doc.url
  }));
} else {

const searchResults = index.search(query, { enrich: true, limit: 100 });





              // Flatten results because it's returned by field
              

const seen = new Set();
flatResults = [];




searchResults.forEach(fieldResult => {
  fieldResult.result.forEach(r => {
      
    if (!seen.has(r.doc.id)) {
      seen.add(r.doc.id);
      flatResults.push(r.doc);
    }
  });
});


}

              
              
if (flatResults.length === 0) {
  resultsContainer.innerHTML = "<p>No results found</p>";
} else {
  const RESULTS_PER_PAGE = 4;
  let currentPage = 1;
  
  let firstLoad = true;

  // Helper: render results for a specific page
 
      function renderPage(page, skipHistory = false) {

    const start = (page - 1) * RESULTS_PER_PAGE;
    const end = start + RESULTS_PER_PAGE;
    const pageResults = flatResults.slice(start, end);

    const WORDS_TO_SHOW = 30;
    const htmlResults = pageResults.map(r => {
      const words = r.content.split(/\s+/).slice(0, WORDS_TO_SHOW).join(' ');
      const more = r.content.split(/\s+/).length > WORDS_TO_SHOW ? "..." : "";
      return `
        <div class="results">
          <a href="${r.url}" class="result-link">
            <h2 class="result-title">${r.title}</h2>
            <div class="author"></div>
            <div class="snippet">${words}${more}</div>
          </a>
        </div>
      `;
    }).join('');

    // Pagination buttons
    const totalPages = Math.ceil(flatResults.length / RESULTS_PER_PAGE);
    let paginationHTML = `<div class="pagination" style="text-align:center; margin-top:1rem;">`;

    // Prev button
    paginationHTML += `<button ${page === 1 ? 'disabled' : ''} data-page="${page - 1}">Prev</button>`;

    // Page numbers (show up to 7 pages centered around current)
    const maxVisible = 7;
    const startPage = Math.max(1, page - Math.floor(maxVisible / 2));
    const endPage = Math.min(totalPages, startPage + maxVisible - 1);

    for (let i = startPage; i <= endPage; i++) {
      paginationHTML += `<button data-page="${i}" ${i === page ? 'style="background-color:#1a3faa;color:white;border:none;padding:5px 10px;border-radius:4px;"' : ''}>${i}</button>`;
    }

    // Next button
    paginationHTML += `<button ${page === totalPages ? 'disabled' : ''} data-page="${page + 1}">Next</button>`;
    paginationHTML += `</div>`;

    resultsContainer.innerHTML = htmlResults + paginationHTML;
    
    // Call this line inside renderPage, right after resultsContainer.innerHTML = ...
/**if (!skipHistory) {
  const newUrl = window.location.pathname + "?q=" + encodeURIComponent(searchInput.value.trim()) + (page > 1 ? `&page=${page}` : '');
  history.pushState({ page }, "", newUrl);
}
**/

  if (!skipHistory && !firstLoad) {
    const newUrl = window.location.pathname + "?q=" + encodeURIComponent(searchInput.value.trim()) + (page > 1 ? `&page=${page}` : '');
    history.pushState({ page }, "", newUrl);
  }
  firstLoad = false;

    // Attach button click handlers
    resultsContainer.querySelectorAll('.pagination button[data-page]').forEach(btn => {
      btn.addEventListener('click', () => {
        const newPage = parseInt(btn.dataset.page);
        if (newPage >= 1 && newPage <= totalPages && newPage !== currentPage) {
          currentPage = newPage;
          renderPage(currentPage);
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      });
    });
  }

  // Initial render
 renderPage(currentPage);


// Handle browser back/forward within pagination
window.addEventListener("popstate", (event) => {
  const page = event.state?.page || 1;
  currentPage = page;
  renderPage(currentPage, true);
});



}
              
      /**        
// old
              // Show results
              if (flatResults.length === 0) {
                resultsContainer.innerHTML = "<p>No results found</p>";
              } else {
                
                
                
                
                const WORDS_TO_SHOW = 30; // <-- adjustable number of words

resultsContainer.innerHTML = flatResults.map(r => {
  // Split content into words and take the first N words
  const words = r.content.split(/\s+/).slice(0, WORDS_TO_SHOW).join(' ');
  const more = r.content.split(/\s+/).length > WORDS_TO_SHOW ? "..." : "";
  
  return `
    
    <div class="results">
  <a href="${r.url}" class="result-link">
    <h2 class="result-title">${r.title}</h2>
    <div class="author"></div>
    <div class="snippet">${words}${more}</div>
  </a>
</div>
  `;
}).join('');
                
                
                
                
              }
              
              
              **/
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            });
        
            
            
            // --- Auto-run search if ?q= is present in the URL ---
const urlParams = new URLSearchParams(window.location.search);
const queryFromURL = urlParams.get('q');

if (queryFromURL !== null) {   // <-- important: empty string is valid
  searchInput.value = queryFromURL;
  searchForm.dispatchEvent(new Event('submit'));
}


            
            
            
          }

          document.body.style.visibility = 'visible';
        } else if (xhr.readyState === 4) {
          console.error('Failed to load header.html');
        }
      };
      xhr.send();
    });
    
    
    


  </script>





</body>
</html>
